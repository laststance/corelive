# Electron ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> CoreLive Electron ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚³ãƒ¼ãƒ‰æ§‹æˆã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã®åŒ…æ‹¬çš„ãªè§£èª¬

**æœ€çµ‚æ›´æ–°æ—¥:** 2026å¹´1æœˆ11æ—¥  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 0.1.0

---

## ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#1-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ã‚³ãƒ¼ãƒ‰è§£èª¬](#2-ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ã‚³ãƒ¼ãƒ‰è§£èª¬)
3. [èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆæ™‚ç³»åˆ—ï¼‰](#3-èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ™‚ç³»åˆ—)
4. [IPCé€šä¿¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#4-ipcé€šä¿¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
5. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«](#5-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«)
6. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#6-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
7. [ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#7-ãƒ‡ãƒãƒƒã‚°ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 1.1 Full WebView ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

CoreLiveã®Electronã‚¢ãƒ—ãƒªã¯ **Full WebView ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯å¾“æ¥ã®ã€ŒElectronã«åŸ‹ã‚è¾¼ã¿ã‚µãƒ¼ãƒãƒ¼ã‚’æŒã¤ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ç•°ãªã‚Šã€**Webã‚¢ãƒ—ãƒªã‚’ãã®ã¾ã¾è¡¨ç¤ºã™ã‚‹ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ãƒƒãƒ‘ãƒ¼**ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Electron Main Process (electron/main.cjs)                  â”‚
â”‚                                                             â”‚
â”‚  â”œâ”€â”€ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ¶å¾¡ã®ã¿ (ãƒ‡ãƒ¼ã‚¿IPC ãªã—)                      â”‚
â”‚  â”œâ”€â”€ èªè¨¼åŒæœŸ (preload APIçµŒç”±)                             â”‚
â”‚  â”œâ”€â”€ ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ (ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ãƒˆãƒ¬ã‚¤ã€é€šçŸ¥ã€ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ)     â”‚
â”‚  â””â”€â”€ Deep Link / OAuthå‡¦ç†                                  â”‚
â”‚                                                             â”‚
â”‚ Electron Renderer (BrowserWindow)                          â”‚
â”‚  â”œâ”€â”€ æœ¬ç•ª: https://corelive.app/ ã‚’ç›´æ¥ãƒ­ãƒ¼ãƒ‰               â”‚
â”‚  â”œâ”€â”€ é–‹ç™º: http://localhost:3011 ã‚’ãƒ­ãƒ¼ãƒ‰                   â”‚
â”‚  â””â”€â”€ oRPC via HTTP (Webã¨åŒä¸€ã®ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãªãœ Full WebView ãªã®ã‹ï¼Ÿ

| ãƒ¡ãƒªãƒƒãƒˆ       | èª¬æ˜                                       |
| -------------- | ------------------------------------------ |
| **ã‚³ãƒ¼ãƒ‰å‰Šæ¸›** | 2,800è¡Œä»¥ä¸Šã®IPC/ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤    |
| **ä¸€è²«æ€§**     | Webç‰ˆã¨Electronç‰ˆã§åŒä¸€ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼      |
| **å³æ™‚æ›´æ–°**   | ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ã§ä¸¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜  |
| **ä¿å®ˆæ€§**     | å˜ä¸€ã®oRPCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰               |

| ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ             | å¯¾ç­–                           |
| ---------------------- | ------------------------------ |
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šå¿…é ˆ | å°†æ¥çš„ã«ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚µãƒãƒ¼ãƒˆæ¤œè¨ |
| èªè¨¼åŒæœŸã®è¤‡é›‘ã•       | preload APIã§è§£æ±º              |

### 1.3 ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ‡ãƒ«

Electronã¯è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ã§å‹•ä½œã—ã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Main Process                        â”‚
â”‚  (electron/main.cjs)                                    â”‚
â”‚  - Node.js ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹                                  â”‚
â”‚  - OS API ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€é€šçŸ¥ç­‰ï¼‰          â”‚
â”‚  - BrowserWindow ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆãƒ»ç®¡ç†                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ IPC (ipcMain â†” ipcRenderer)
                     â”‚ preload.cjs ã§ API ã‚’ãƒ–ãƒªãƒƒã‚¸
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Renderer Process                      â”‚
â”‚  (BrowserWindow å†…ã® Chromium)                          â”‚
â”‚  - Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º                                   â”‚
â”‚  - window.electronAPI çµŒç”±ã§ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡         â”‚
â”‚  - Node.js ã‚¢ã‚¯ã‚»ã‚¹ãªã—ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ã‚³ãƒ¼ãƒ‰è§£èª¬

### 2.1 ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã¨è²¬å‹™

```
electron/
â”œâ”€â”€ main.cjs                      # ğŸ¯ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ dev-runner.cjs                # ğŸ”§ é–‹ç™ºç”¨èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ preload.cjs                   # ğŸ” ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ IPC ãƒ–ãƒªãƒƒã‚¸
â”œâ”€â”€ preload-floating.cjs          # ğŸ” ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ IPC ãƒ–ãƒªãƒƒã‚¸
â”‚
â”œâ”€â”€ WindowManager.cjs             # ğŸªŸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†
â”œâ”€â”€ WindowStateManager.cjs        # ğŸ’¾ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦çŠ¶æ…‹æ°¸ç¶šåŒ–
â”œâ”€â”€ ConfigManager.cjs             # âš™ï¸ è¨­å®šç®¡ç†
â”œâ”€â”€ MenuManager.cjs               # ğŸ“‹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”œâ”€â”€ SystemTrayManager.cjs         # ğŸ”” ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤
â”œâ”€â”€ ShortcutManager.cjs           # âŒ¨ï¸ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
â”œâ”€â”€ NotificationManager.cjs       # ğŸ“¢ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—é€šçŸ¥
â”œâ”€â”€ DeepLinkManager.cjs           # ğŸ”— ã‚«ã‚¹ã‚¿ãƒ URLãƒ—ãƒ­ãƒˆã‚³ãƒ«
â”œâ”€â”€ OAuthManager.cjs              # ğŸ”‘ OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ AutoUpdater.cjs               # â¬†ï¸ è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
â”œâ”€â”€ auth-manager.cjs              # ğŸ‘¤ èªè¨¼çŠ¶æ…‹ç®¡ç†
â”‚
â”œâ”€â”€ IPCErrorHandler.cjs           # âŒ IPCã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”œâ”€â”€ SystemIntegrationErrorHandler.cjs # âš ï¸ ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚¨ãƒ©ãƒ¼
â”œâ”€â”€ LazyLoadManager.cjs           # ğŸš€ é…å»¶èª­ã¿è¾¼ã¿
â”œâ”€â”€ MemoryProfiler.cjs            # ğŸ“Š ãƒ¡ãƒ¢ãƒªç›£è¦–
â”œâ”€â”€ performance-config.cjs        # âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
â”œâ”€â”€ logger.cjs                    # ğŸ“ ãƒ­ã‚°å‡ºåŠ›
â”‚
â””â”€â”€ __tests__/                    # ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
    â”œâ”€â”€ main-process.test.mjs
    â”œâ”€â”€ preload-security.test.mjs
    â””â”€â”€ ...
```

### 2.2 ã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°è§£èª¬

#### 2.2.1 `main.cjs` - ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ

**å½¹å‰²:** Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
// ä¸»è¦ãªè²¬å‹™
const {
  app, // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
  BrowserWindow, // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä½œæˆ
  ipcMain, // IPCå—ä¿¡
  session, // ã‚»ãƒƒã‚·ãƒ§ãƒ³/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
} = require('electron')

// ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆåˆæœŸåŒ–é †åºãŒé‡è¦ï¼‰
let configManager // è¨­å®šç®¡ç†
let windowStateManager // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦çŠ¶æ…‹
let windowManager // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†
let ipcErrorHandler // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

// é…å»¶åˆæœŸåŒ–ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
let autoUpdater
let systemTrayManager
let notificationManager
// ... ä»–ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
```

**ä¸»è¦é–¢æ•°:**

| é–¢æ•°                 | è²¬å‹™                                     |
| -------------------- | ---------------------------------------- |
| `createWindow()`     | ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä½œæˆã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ– |
| `setupIPCHandlers()` | å…¨IPCãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ç™»éŒ²                    |
| `setupSecurity()`    | CSPã€ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨­å®š                  |
| `app.whenReady()`    | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®å‡¦ç†                       |

#### 2.2.2 `WindowManager.cjs` - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†

**å½¹å‰²:** BrowserWindowã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

```javascript
class WindowManager {
  constructor(serverUrl, configManager, windowStateManager)

  // ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
  createMainWindow()     // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä½œæˆ
  getMainWindow()        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—
  hasMainWindow()        // å­˜åœ¨ç¢ºèª

  // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚¿
  createFloatingNavigator()
  showFloatingNavigator()
  hideFloatingNavigator()
  toggleFloatingNavigator()

  // ãƒˆãƒ¬ã‚¤é€£æº
  minimizeToTray()
  restoreFromTray()

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  cleanup()
}
```

**ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¨­å®šã®ç‰¹å¾´:**

```javascript
const mainWindow = new BrowserWindow({
  width: 1200,
  height: 800,
  titleBarStyle: 'hiddenInset', // macOS ãƒã‚¤ãƒ†ã‚£ãƒ–é¢¨
  webPreferences: {
    preload: path.join(__dirname, 'preload.cjs'),
    contextIsolation: true, // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: åˆ†é›¢
    nodeIntegration: false, // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: Nodeç„¡åŠ¹
    sandbox: true, // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
  },
})
```

#### 2.2.3 `preload.cjs` - IPCãƒ–ãƒªãƒƒã‚¸

**å½¹å‰²:** ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã«å®‰å…¨ãªAPIã‚’å…¬é–‹

```javascript
const { contextBridge, ipcRenderer } = require('electron')

// è¨±å¯ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
const ALLOWED_CHANNELS = [
  'window-close',
  'window-minimize',
  'auth-get-user',
  'auth-set-user',
  // ... ç´„80ãƒãƒ£ãƒ³ãƒãƒ«
]

// ã‚»ã‚­ãƒ¥ã‚¢ãªAPIå…¬é–‹
contextBridge.exposeInMainWorld('electronAPI', {
  // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œ
  window: {
    close: () => ipcRenderer.invoke('window-close'),
    minimize: () => ipcRenderer.invoke('window-minimize'),
    toggleFloatingNavigator: () =>
      ipcRenderer.invoke('window-toggle-floating-navigator'),
  },

  // èªè¨¼
  auth: {
    getUser: () => ipcRenderer.invoke('auth-get-user'),
    setUser: (user) => ipcRenderer.invoke('auth-set-user', user),
    syncFromWeb: (authData) =>
      ipcRenderer.invoke('auth-sync-from-web', authData),
  },

  // é€šçŸ¥
  notifications: {
    show: (title, body, options) =>
      ipcRenderer.invoke('notification-show', title, body, options),
    // ...
  },

  // ... ä»–ã®API
})
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ:**

```javascript
// âœ… Good: ãƒãƒ£ãƒ³ãƒãƒ«ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§æ¤œè¨¼
function validateChannel(channel) {
  if (!ALLOWED_CHANNELS.includes(channel)) {
    throw new Error(`Invalid IPC channel: ${channel}`)
  }
}

// âœ… Good: ãƒ‡ãƒ¼ã‚¿ã‚µãƒ‹ã‚¿ã‚¤ã‚º
function sanitizeData(data) {
  // å¾ªç’°å‚ç…§ã‚„å±é™ºãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é™¤å»
  return JSON.parse(JSON.stringify(data))
}
```

#### 2.2.4 `ConfigManager.cjs` - è¨­å®šç®¡ç†

**å½¹å‰²:** ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®æ°¸ç¶šåŒ–ã¨ç®¡ç†

```javascript
class ConfigManager {
  constructor()

  // è¨­å®šã®èª­ã¿æ›¸ã
  get(key)
  set(key, value)
  getSection(section)
  getAll()

  // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
  loadConfig()
  saveConfig()
  backup()
  reset()

  // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  migrateConfig()
}
```

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€:**

- macOS: `~/Library/Application Support/CoreLive/config.json`

> **Note:** This app only supports macOS.

#### 2.2.5 `MenuManager.cjs` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼

**å½¹å‰²:** macOSãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®æ§‹ç¯‰ã¨ç®¡ç†

```javascript
class MenuManager {
  constructor()

  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ§‹ç¯‰
  createApplicationMenu()
  createAppMenu()        // CoreLive ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  createFileMenu()       // ãƒ•ã‚¡ã‚¤ãƒ«
  createEditMenu()       // ç·¨é›†
  createViewMenu()       // è¡¨ç¤º
  createWindowMenu()     // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
  createHelpMenu()       // ãƒ˜ãƒ«ãƒ—

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  handleMenuAction(action)
  toggleFloatingNavigator()
  showAboutDialog()
}
```

#### 2.2.6 `SystemTrayManager.cjs` - ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤

**å½¹å‰²:** ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼/ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤ã‚¢ã‚¤ã‚³ãƒ³ã®ç®¡ç†

```javascript
class SystemTrayManager {
  constructor(windowManager)

  // ãƒˆãƒ¬ã‚¤æ“ä½œ
  createTray()
  setTrayIconState(state)  // 'active', 'disabled', 'notification'
  setTrayTooltip(text)
  updateTrayMenu(tasks)
  showNotification(title, body)

  // çŠ¶æ…‹ç®¡ç†
  hasTray()
  isSystemTraySupported()
  enableFallbackMode()
}
```

#### 2.2.7 `DeepLinkManager.cjs` - ã‚«ã‚¹ã‚¿ãƒ URLãƒ—ãƒ­ãƒˆã‚³ãƒ«

**å½¹å‰²:** `corelive://` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å‡¦ç†

```javascript
class DeepLinkManager {
  constructor(windowManager)

  // ãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç†
  registerProtocol()        // corelive:// ã‚’ç™»éŒ²
  handleDeepLink(url)       // URLè§£æã¨å‡¦ç†
  parseDeepLinkUrl(url)     // URL ãƒ‘ãƒ¼ã‚¹

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  handleCreateAction(params)   // corelive://create?title=...
  handleViewAction(params)     // corelive://view/task/123
  handleSearchAction(params)   // corelive://search?q=...
  handleOAuthCallback(url)     // corelive://oauth/callback

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  generateDeepLink(action, params)
  getExampleUrls()
}
```

**å¯¾å¿œURLå½¢å¼:**

| URL                                | èª¬æ˜               |
| ---------------------------------- | ------------------ |
| `corelive://create?title=ã‚¿ã‚¹ã‚¯å` | æ–°è¦ã‚¿ã‚¹ã‚¯ä½œæˆ     |
| `corelive://view/task/123`         | ã‚¿ã‚¹ã‚¯è¡¨ç¤º         |
| `corelive://search?q=æ¤œç´¢èª`       | ã‚¿ã‚¹ã‚¯æ¤œç´¢         |
| `corelive://oauth/callback?...`    | OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

#### 2.2.8 `OAuthManager.cjs` - OAuthèªè¨¼

**å½¹å‰²:** Googleç­‰ã®OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼ã®å‡¦ç†

```javascript
class OAuthManager {
  constructor(windowManager, notificationManager)

  // OAuth ãƒ•ãƒ­ãƒ¼
  startOAuthFlow(provider)     // èªè¨¼é–‹å§‹
  handleOAuthCallback(url)     // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
  exchangeCodeForSession(code) // ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›

  // PKCE ã‚µãƒãƒ¼ãƒˆ
  generatePKCE()
  generateState()

  // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
  getSupportedProviders()  // ['google', 'github']
  isProviderSupported(provider)
}
```

---

## 3. èµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆæ™‚ç³»åˆ—ï¼‰

### 3.1 é–‹ç™ºç’°å¢ƒã®èµ·å‹•ãƒ•ãƒ­ãƒ¼

```
pnpm electron:dev
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. scripts/dev.js                                          â”‚
â”‚    - Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•                              â”‚
â”‚    - ãƒãƒ¼ãƒˆ3011ã§å¾…æ©Ÿ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Next.js Ready
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. electron/dev-runner.cjs                                 â”‚
â”‚    - Next.jsã®èµ·å‹•ã‚’ç¢ºèª (checkServer)                     â”‚
â”‚    - Electronãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•                                 â”‚
â”‚    - ç’°å¢ƒå¤‰æ•°: ELECTRON_DEV_SERVER_URL=http://localhost:3011â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Electron Start
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. electron/main.cjs åˆæœŸåŒ–                                â”‚
â”‚                                                             â”‚
â”‚    3.1 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿                                    â”‚
â”‚        - ConfigManager, WindowManager ç­‰ã‚’require          â”‚
â”‚        - logger, memoryProfiler åˆæœŸåŒ–                     â”‚
â”‚                                                             â”‚
â”‚    3.2 æ—©æœŸã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²                                      â”‚
â”‚        - app.on('open-url') - Deep Linkå—ä¿¡ç”¨              â”‚
â”‚        - ã‚·ãƒ³ã‚°ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ­ãƒƒã‚¯å–å¾—                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ app.whenReady()
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. createWindow() - ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«åˆæœŸåŒ–                      â”‚
â”‚                                                             â”‚
â”‚    4.1 ã‚³ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–ï¼ˆé †åºé‡è¦ï¼‰                    â”‚
â”‚        â‘  IPCErrorHandler                                   â”‚
â”‚        â‘¡ ConfigManager                                     â”‚
â”‚        â‘¢ WindowStateManager                                â”‚
â”‚        â‘£ WindowManager                                     â”‚
â”‚                                                             â”‚
â”‚    4.2 ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä½œæˆ                                  â”‚
â”‚        - BrowserWindow ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ                     â”‚
â”‚        - preload.cjs èª­ã¿è¾¼ã¿                               â”‚
â”‚        - http://localhost:3011 ã‚’ãƒ­ãƒ¼ãƒ‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¡¨ç¤º
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. setupIPCHandlers() - IPCãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²                   â”‚
â”‚                                                             â”‚
â”‚    - window-* (ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œ)                              â”‚
â”‚    - auth-* (èªè¨¼)                                          â”‚
â”‚    - config-* (è¨­å®š)                                        â”‚
â”‚    - notification-* (é€šçŸ¥)                                  â”‚
â”‚    - ... ç´„50å€‹ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ setImmediate (é…å»¶å®Ÿè¡Œ)
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. é…å»¶åˆæœŸåŒ– (Deferred Init)                               â”‚
â”‚                                                             â”‚
â”‚    6.1 LazyLoadManagerçµŒç”±ã§éã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ â”‚
â”‚        - SystemIntegrationErrorHandler                     â”‚
â”‚        - MenuManager                                        â”‚
â”‚        - SystemTrayManager                                  â”‚
â”‚        - NotificationManager                                â”‚
â”‚        - ShortcutManager                                    â”‚
â”‚                                                             â”‚
â”‚    6.2 å„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–                                â”‚
â”‚        - ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ§‹ç¯‰                                        â”‚
â”‚        - ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤ä½œæˆ                                  â”‚
â”‚        - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç™»éŒ²                        â”‚
â”‚                                                             â”‚
â”‚    6.3 DeepLinkManager / OAuthManager åˆæœŸåŒ–                â”‚
â”‚        - corelive:// ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç™»éŒ²                         â”‚
â”‚        - ä¿ç•™ä¸­ã®Deep Linkå‡¦ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ setupSecurity()
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š                                          â”‚
â”‚                                                             â”‚
â”‚    - Content Security Policy (CSP) é©ç”¨                    â”‚
â”‚    - ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š                            â”‚
â”‚    - WebContents ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒƒã‚¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†
```

### 3.2 æœ¬ç•ªç’°å¢ƒã®èµ·å‹•ãƒ•ãƒ­ãƒ¼

æœ¬ç•ªç’°å¢ƒã§ã¯ `scripts/dev.js` ã¨ `dev-runner.cjs` ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ç›´æ¥ `main.cjs` ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

```
CoreLive.app èµ·å‹•
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ electron/main.cjs                                          â”‚
â”‚                                                             â”‚
â”‚ serverUrl = null (æœªè¨­å®š)                                   â”‚
â”‚ â†’ WindowManager ãŒ https://corelive.app/ ã‚’ãƒ­ãƒ¼ãƒ‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ã‚¢ãƒ—ãƒªä½¿ç”¨ä¸­ã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‹ã‚‰ã®å…¸å‹çš„ãªãƒ•ãƒ­ãƒ¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: TODOã‚’è¿½åŠ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Renderer Process (Next.js ã‚¢ãƒ—ãƒª)                          â”‚
â”‚                                                             â”‚
â”‚ 1. ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡                                              â”‚
â”‚ 2. oRPC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå‘¼ã³å‡ºã—                                 â”‚
â”‚    client.todo.create({ text: "æ–°ã—ã„ã‚¿ã‚¹ã‚¯" })             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP POST to /api/orpc/todo.create
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js ã‚µãƒ¼ãƒãƒ¼ (corelive.app)                             â”‚
â”‚                                                             â”‚
â”‚ 1. oRPC ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼                                     â”‚
â”‚ 2. Prisma ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ                                 â”‚
â”‚ 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP Response
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Renderer Process                                            â”‚
â”‚                                                             â”‚
â”‚ 1. React Query ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°                              â”‚
â”‚ 2. UI å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. IPCé€šä¿¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 4.1 IPCãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§

#### ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œ (`window-*`)

| ãƒãƒ£ãƒ³ãƒãƒ«                       | æ–¹å‘ | èª¬æ˜                           |
| -------------------------------- | ---- | ------------------------------ |
| `window-close`                   | Râ†’M  | ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹             |
| `window-minimize`                | Râ†’M  | æœ€å°åŒ–                         |
| `window-show-floating-navigator` | Râ†’M  | ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚¿è¡¨ç¤º   |
| `window-hide-floating-navigator` | Râ†’M  | ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚¿éè¡¨ç¤º |

#### èªè¨¼ (`auth-*`)

| ãƒãƒ£ãƒ³ãƒãƒ«           | æ–¹å‘ | èª¬æ˜                  |
| -------------------- | ---- | --------------------- |
| `auth-get-user`      | Râ†’M  | ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—    |
| `auth-set-user`      | Râ†’M  | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¨­å®š      |
| `auth-sync-from-web` | Râ†’M  | Webã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰åŒæœŸ |
| `auth-logout`        | Râ†’M  | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ            |

#### é€šçŸ¥ (`notification-*`)

| ãƒãƒ£ãƒ³ãƒãƒ«                        | æ–¹å‘ | èª¬æ˜     |
| --------------------------------- | ---- | -------- |
| `notification-show`               | Râ†’M  | é€šçŸ¥è¡¨ç¤º |
| `notification-get-preferences`    | Râ†’M  | è¨­å®šå–å¾— |
| `notification-update-preferences` | Râ†’M  | è¨­å®šæ›´æ–° |

#### OAuth (`oauth-*`)

| ãƒãƒ£ãƒ³ãƒãƒ«      | æ–¹å‘ | èª¬æ˜       |
| --------------- | ---- | ---------- |
| `oauth-start`   | Râ†’M  | OAuthé–‹å§‹  |
| `oauth-success` | Mâ†’R  | æˆåŠŸé€šçŸ¥   |
| `oauth-error`   | Mâ†’R  | ã‚¨ãƒ©ãƒ¼é€šçŸ¥ |

### 4.2 IPCé€šä¿¡ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: invoke/handle (ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹)

```javascript
// Main Process (main.cjs)
ipcMain.handle('auth-get-user', async () => {
  return activeUser
})

// Preload (preload.cjs)
contextBridge.exposeInMainWorld('electronAPI', {
  auth: {
    getUser: () => ipcRenderer.invoke('auth-get-user'),
  },
})

// Renderer (React)
const user = await window.electronAPI.auth.getUser()
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: send/on (ä¸€æ–¹å‘ã‚¤ãƒ™ãƒ³ãƒˆ)

```javascript
// Main Process â†’ Renderer
mainWindow.webContents.send('auth-state-changed', { user })

// Preload
contextBridge.exposeInMainWorld('electronAPI', {
  onAuthStateChanged: (callback) =>
    ipcRenderer.on('auth-state-changed', (_event, data) => callback(data)),
})

// Renderer
window.electronAPI.onAuthStateChanged((data) => {
  console.log('Auth changed:', data)
})
```

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«

### 5.1 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸå‰‡

| åŸå‰‡                         | å®Ÿè£…                     |
| ---------------------------- | ------------------------ |
| **Context Isolation**        | `contextIsolation: true` |
| **Node Integration ç„¡åŠ¹**    | `nodeIntegration: false` |
| **ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹**           | `sandbox: true`          |
| **ãƒãƒ£ãƒ³ãƒãƒ«ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ** | `ALLOWED_CHANNELS` é…åˆ—  |

### 5.2 Content Security Policy (CSP)

```javascript
const CSP_POLICY = [
  "default-src 'self'",
  "script-src 'self' 'unsafe-inline' https://clerk.corelive.app ...",
  "connect-src 'self' http://localhost:* https://clerk.corelive.app ...",
  "frame-src 'self' https://clerk.corelive.app ...",
  "object-src 'none'",
].join('; ')
```

### 5.3 ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

```javascript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ© - æ˜ç¤ºçš„ã«è¨±å¯ã—ãŸã‚‚ã®ã®ã¿é€šé
session.defaultSession.setPermissionRequestHandler(
  (_webContents, permission, callback) => {
    const allowedPermissions = ['notifications']
    callback(allowedPermissions.includes(permission))
  },
)

// ãƒã‚§ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ© - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ‹’å¦
session.defaultSession.setPermissionCheckHandler(() => false)
```

---

## 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 6.1 é…å»¶èª­ã¿è¾¼ã¿ (Lazy Loading)

éã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ `LazyLoadManager` çµŒç”±ã§é…å»¶èª­ã¿è¾¼ã¿ï¼š

```javascript
// èµ·å‹•æ™‚ã¯èª­ã¿è¾¼ã¾ãªã„
const MenuManager = await lazyLoadManager.loadComponent('MenuManager')
```

**é…å»¶èª­ã¿è¾¼ã¿å¯¾è±¡:**

- MenuManager
- SystemTrayManager
- NotificationManager
- ShortcutManager
- AutoUpdater
- DeepLinkManager
- OAuthManager

### 6.2 ãƒ¡ãƒ¢ãƒªç›£è¦–

`MemoryProfiler` ãŒãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç›£è¦–ã—ã€ã—ãã„å€¤è¶…éæ™‚ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼š

```javascript
memoryProfiler.startMonitoring({
  interval: 30000, // 30ç§’ã”ã¨
  threshold: 512, // 512MB ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
})
```

### 6.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š

ç’°å¢ƒã«å¿œã˜ãŸæœ€é©åŒ–ãƒ¬ãƒ™ãƒ«ï¼š

```javascript
const OPTIMIZATION_LEVELS = {
  development: {
    enableMemoryMonitoring: false,
    lazyLoadDelay: 0, // å³åº§ã«ãƒ­ãƒ¼ãƒ‰
  },
  production: {
    enableMemoryMonitoring: true,
    lazyLoadDelay: 500, // 500ms é…å»¶
  },
}
```

---

## 7. ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 7.1 ãƒ­ã‚°ç¢ºèª

`logger.cjs` ã¯ Pino ã‚’ä½¿ç”¨ã—ãŸæ§‹é€ åŒ–ãƒ­ã‚°ã‚’å‡ºåŠ›ï¼š

```javascript
const { log } = require('./logger.cjs')

log.info('Message', { data })
log.error('Error', error)
log.debug('Debug info')
```

**é–‹ç™ºç’°å¢ƒ:** ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚«ãƒ©ãƒ¼å‡ºåŠ›  
**æœ¬ç•ªç’°å¢ƒ:** JSONå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›

### 7.2 DevTools ã‚’é–‹ã

é–‹ç™ºç’°å¢ƒã§ã¯è‡ªå‹•çš„ã«DevToolsãŒé–‹ãã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§é–‹ãã«ã¯ï¼š

```javascript
// View â†’ Toggle Developer Tools
// ã¾ãŸã¯ Cmd+Option+I (macOS)
```

### 7.3 IPCãƒ‡ãƒãƒƒã‚°

`IPCErrorHandler` ãŒå…¨IPCã‚¨ãƒ©ãƒ¼ã‚’è¨˜éŒ²ï¼š

```javascript
ipcErrorHandler.getStats()
// {
//   totalCalls: 150,
//   errors: 2,
//   successRate: 98.67,
//   commonErrors: [...]
// }
```

### 7.4 ã‚ˆãã‚ã‚‹å•é¡Œ

| å•é¡Œ               | åŸå›              | è§£æ±ºç­–                             |
| ------------------ | ---------------- | ---------------------------------- |
| ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒç™½ã„   | CSPé•å          | DevTools Console ã§ã‚¨ãƒ©ãƒ¼ç¢ºèª      |
| IPCå¿œç­”ãªã—        | ãƒãƒ£ãƒ³ãƒãƒ«æœªç™»éŒ² | `ALLOWED_CHANNELS` ç¢ºèª            |
| ãƒˆãƒ¬ã‚¤ã‚¢ã‚¤ã‚³ãƒ³ãªã— | ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹èª¤ã‚Š | `build/icons/` ç¢ºèª                |
| Deep Linkæœªå‹•ä½œ    | ãƒ—ãƒ­ãƒˆã‚³ãƒ«æœªç™»éŒ² | `app.isDefaultProtocolClient` ç¢ºèª |

---

## å‚è€ƒè³‡æ–™

- [Electron å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.electronjs.org/docs/latest/)
- [Electron ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰](https://www.electronjs.org/docs/latest/tutorial/security)
- [contextBridge API](https://www.electronjs.org/docs/latest/api/context-bridge)
- [IPC é€šä¿¡](https://www.electronjs.org/docs/latest/tutorial/ipc)

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ:** AI Assistant (Claude)  
**æ¤œè¨¼:** æ‰‹å‹•æ¤œè¨¼æ¨å¥¨
